<?xml version="1.0" encoding="utf-8"?>
<robot name="final3">

  <gazebo>
    <physics type="ode">
      <max_step_size>0.001</max_step_size>
      <real_time_update_rate>1000</real_time_update_rate>
      <ode>
        <solver>
          <iters>100</iters>
          <sor>1.3</sor>
        </solver>
        <constraints>
          <erp>0.2</erp>
          <cfm>0.0</cfm>
          <contact_surface_layer>0.0005</contact_surface_layer>
          <contact_max_correcting_vel>100</contact_max_correcting_vel>
        </constraints>
      </ode>
    </physics>
    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
      <robotNamespace>/</robotNamespace>
      <controlPeriod>0.001</controlPeriod>
    </plugin>
  </gazebo>

  <!-- Base stand friction/damping -->
  <gazebo reference="base_stand">
    <mu1>3.0</mu1><mu2>3.0</mu2>
    <slip1>0.0</slip1><slip2>0.0</slip2>
    <kp>2000000</kp><kd>5.0</kd>
    <linearDamping>0.3</linearDamping>
    <angularDamping>0.3</angularDamping>
  </gazebo>

  <!-- ===== Links / Joints ===== -->

  <link name="base_stand">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="15.0"/>
      <inertia ixx="0.2045" iyy="0.2045" izz="0.4000" ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual><origin xyz="0 0 -0.03" rpy="0 0 0"/><geometry><box size="0.40 0.40 0.06"/></geometry></visual>
    <collision><origin xyz="0 0 -0.03" rpy="0 0 0"/><geometry><box size="0.40 0.40 0.06"/></geometry></collision>
  </link>

  <joint name="base_stand_fix" type="fixed">
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <parent link="base_stand"/>
    <child link="base_link"/>
  </joint>

  <link name="base_link">
    <inertial>
      <origin xyz="-0.00336427008800971 0 0.176177481833415" rpy="0 0 0"/>
      <mass value="1.13227805038393"/>
      <inertia ixx="0.0121531021222289" ixy="-3.59019259225343E-19" ixz="0.000587859098098468"
               iyy="0.0119525756112575" iyz="-2.78003552835926E-18" izz="0.00102146038185239"/>
    </inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://final3/meshes/base_link.STL"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://final3/meshes/base_link.STL"/></geometry></collision>
  </link>

  <link name="l1">
    <inertial>
      <origin xyz="-0.189428590016577 -0.064162366573651 5.55111512312578E-17" rpy="0 0 0"/>
      <mass value="1.3016523193261"/>
      <inertia ixx="0.00219848452395246" ixy="-0.00342968551632687" ixz="0"
               iyy="0.011162366813926" iyz="0" izz="0.0116571619649917"/>
    </inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://final3/meshes/l1.STL"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://final3/meshes/l1.STL"/></geometry></collision>
  </link>

  <joint name="j1" type="revolute">
    <origin xyz="-0.065 0 0.278" rpy="0 0 0"/>
    <parent link="base_link"/><child link="l1"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.57" upper="1.57" effort="40" velocity="0.5"/>
    <dynamics damping="0.02" friction="0.0"/>
  </joint>

  <link name="l2">
    <inertial>
      <origin xyz="-0.323439138443078 0.0292504033924335 0.0100322732874896" rpy="0 0 0"/>
      <mass value="3.6875217386648"/>
      <inertia ixx="0.0014809901425467" ixy="0.00089641488545978" ixz="-1.00733265699137E-07"
               iyy="0.0114085095981645" iyz="5.98503904057003E-07" izz="0.0120439794121417"/>
    </inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://final3/meshes/l2.STL"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://final3/meshes/l2.STL"/></geometry></collision>
  </link>

  <joint name="j2" type="revolute">
    <origin xyz="-0.37876 -0.12724 -0.0935" rpy="0 0 0"/>
    <parent link="l1"/><child link="l2"/>
    <axis xyz="0 0 1"/>
    <limit lower="-3.14" upper="3.14" effort="30" velocity="0.5"/>
    <dynamics damping="0.02" friction="0.0"/>
  </joint>

  <!-- ===== Gimbal: PITCH ===== -->
  <link name="pitch">
    <inertial>
      <!-- Inertial origin aligned with link frame (joint pivot is defined by joint origin below) -->
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="0.02"/>
      <inertia
        ixx="3.2092E-08"
        ixy="7.6869E-14"
        ixz="4.9764E-15"
        iyy="3.2093E-08"
        iyz="4.1593E-15"
        izz="4.6816E-08" />
    </inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://final3/meshes/pitch.STL"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://final3/meshes/pitch.STL"/></geometry></collision>
  </link>

  <joint name="pitch_j" type="revolute">
    <!-- Keep your real mounting pose -->
    <origin xyz="-0.39841 0.035635 0.0875" rpy="0 0 0"/>
    <parent link="l2"/><child link="pitch"/>
   <axis xyz="-0.99602 0.089087 0"/>
    <limit lower="-0.6" upper="0.6" effort="20" velocity="0.5"/>
    <dynamics damping="0.05" friction="0.0"/>
  </joint>

  <!-- ===== Gimbal: ROLL ===== -->
  <link name="roll">
    <inertial>
      <origin
        xyz="-2.3765E-09 -3.7085E-08 0.049659"
        rpy="0 0 0" />
      <mass
        value="0.014628" />
      <inertia
        ixx="4.8925E-06"
        ixy="-2.8915E-09"
        ixz="-1.7932E-13"
        iyy="4.8604E-06"
        iyz="-2.5938E-12"
        izz="3.3066E-07" />
    </inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://final3/meshes/roll.STL"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://final3/meshes/roll.STL"/></geometry></collision>
  </link>

  <joint name="roll_j" type="revolute">
    <!-- Keep your real mounting pose -->
    <origin xyz="-9.658E-05 -0.0010798 0" rpy="0 0 0"/>
    <parent link="pitch"/><child link="roll"/>
     <axis xyz="-0.089087 -0.99602 0"/>
    <limit lower="-0.6" upper="0.6" effort="25" velocity="0.5"/>
    <dynamics damping="0.05" friction="0.0"/>
  </joint>

  <!-- ===== Transmissions ===== -->
  <transmission name="pitch_tr">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="pitch_j">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="pitch_motor">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="roll_tr">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="roll_j">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
    </joint>
    <actuator name="roll_motor">
      <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="j1_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="j1_motor">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="j1">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    </joint>
  </transmission>

  <transmission name="j2_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <actuator name="j2_motor">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
    <joint name="j2">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    </joint>
  </transmission>

</robot>
